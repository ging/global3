/**AjaxFlagMenu v1.0.2 is a simple vertical menu jQuery plugin (inspired from facebook) 2010/2011
 * @author Seddiki Mohammed <seddikimohammed@gmail.com>
 *
 * Licence GNU GPL
 * */
(function($,document){

        $.fn.AjaxFlagMenu = function(Options)
        {

                var LastSelectedItem = null;
                //class to treat AjaxFlagMenuItem
                function AjaxFlagMenuItem(_Title,
                                                                  _onOutIcon,
                                                                  _onClickIcon,
                                                                  _HtmlStatusContent,
                                                                  _url,
                                                                  _data)
                {
                        /**Fields********************************************************************/
                        //Title
                        var Title = $("<td>"+ _Title+"</td>") ;
                                Title.attr("width","60%");
                        //Icon
                        var Icon = $('<td><img /></td>') ;
                                Icon.attr("width","10%");
                        //HtmlStatusContent
                        var HtmlStatusContent = $("<td><div>"+_HtmlStatusContent +"</div></td>") ;
                                HtmlStatusContent.attr("width","30%");


                        //AjaxFlagMenuItem
                        var _AjaxFlagMenuItem = $("<li><table><tr></tr></table></li>");

                                //setup the AjaxFlagMenuItem
                                        _AjaxFlagMenuItem.find("table").attr("border","0");
                                        _AjaxFlagMenuItem.find("table").attr("width","100%");
                                        _AjaxFlagMenuItem.attr("title",Title.text());

                                        //add components to AjaxFlagMenuItem
                                        _AjaxFlagMenuItem.find("table").find("tr").append(Icon);
                                        _AjaxFlagMenuItem.find("table").find("tr").append(Title);
                                        _AjaxFlagMenuItem.find("table").find("tr").append(HtmlStatusContent);

                                        //AjaxFlagMenuItem CSS
                                        _AjaxFlagMenuItem.css("cursor","pointer");
                                        _AjaxFlagMenuItem.css("padding","1px");


                        /**Global Functions**************************************/
                        this.jQueryObject = _AjaxFlagMenuItem;

                        this.setOnOutStatus = function ()
                        {
                                setIcon(_onOutIcon);
                                setAjaxFlagMenuItemClass(Options.onOutClass);
                                setHtmlStatusContentClass(Options.hscClickClass);

                        };
                        this.isClicked = function()
                        {
                                return _AjaxFlagMenuItem.hasClass(Options.onClickClass);
                        };
                        this.sethscCorner = function()
                        {
                                if(_HtmlStatusContent != '')
                                {
                                        HtmlStatusContent.find("div").corner("4px");
                                }
                        };
                        /**Local Functions**************************************/
                        function setIcon(img)
                        {
                                Icon.find("img").attr("src",img);

                        }
                        function setAjaxFlagMenuItemClass(_class)
                        {
                                _AjaxFlagMenuItem.attr("class",_class);
                        }
                        function setHtmlStatusContentClass(_class)
                        {
                                if(_HtmlStatusContent != '')
                                {
                                        HtmlStatusContent.find("div").attr("class",_class);
                                }
                        }
                        function setHtmlStatusContent(HtmlContent)
                        {
                                HtmlStatusContent.html(HtmlContent);
                        }
                        /**Events*****************************************************************************/
                        //onMouseOver
                        _AjaxFlagMenuItem.mouseover(function(){

                                if(!_AjaxFlagMenuItem.hasClass(Options.onClickClass))
                                {
                                        setAjaxFlagMenuItemClass(Options.onOverClass);
                                        //Uncorner
                                        _AjaxFlagMenuItem.uncorner();
                                }
                        });
                        //onMouseOut
                        _AjaxFlagMenuItem.mouseout(function(){

                                if(!_AjaxFlagMenuItem.hasClass(Options.onClickClass))
                                {
                                        setAjaxFlagMenuItemClass(Options.onOutClass);
                                }
                        });
                        //onMouseClick
                        _AjaxFlagMenuItem.click(function(){

                                if(!_AjaxFlagMenuItem.hasClass(Options.onClickClass))
                                {
                                        setIcon(_onClickIcon);
                                        setAjaxFlagMenuItemClass(Options.onClickClass);
                                        setHtmlStatusContentClass(Options.hscOutClass);

                                        if(LastSelectedItem != null)
                                        {
                                                LastSelectedItem.setOnOutStatus();
                                        }
                                        //Corner
                                        _AjaxFlagMenuItem.corner("4px");
                                        //Ajax
                                        var _XMLHTTPRequest = $.ajax({type: "GET",url:_url,data:_data });

                                        _XMLHTTPRequest.onreadystatechange = function()
                                        {
                                                if(_XMLHTTPRequest.readyState == 3)
                                                {
                                                        setHtmlStatusContent('<img src="../'+ Options.Loading_gif +'" />');
                                                }
                                                if(_XMLHTTPRequest.readyState == 4)
                                                {
                                                        if(_XMLHTTPRequest.status == 200)
                                                        {
                                                                $("#"+Options.ajaxContent).html(_XMLHTTPRequest.responseText);
                                                                setHtmlStatusContent('<div>'+ _HtmlStatusContent +'</div>');
                                                                setHtmlStatusContentClass(Options.hscOutClass);
                                                                HtmlStatusContent.find("div").corner("4px");
                                                        }
                                                }
                                        };


                                }

                        });
                };
                //end AjaxFlagMenuItem Class

                //Menu Title
                var Caption = $("<li>"+ Options.Caption +"</li>");
                        Caption.addClass(Options.CaptionClass);

                //table to stock items
                var iTems = new Array();

                //Global Menu
                var AjaxFlagMenu = $("<ul></ul>");
                        AjaxFlagMenu.css("list-style","none");


                        //append a title to Menu
                        AjaxFlagMenu.append(Caption);

                //function to add item to Menu
                this.add = function(_Options)
                {
                        var item = new AjaxFlagMenuItem(_Options.Title,
                                                                                        _Options.onOutIcon,
                                                                                        _Options.onClickIcon,
                                                                                        _Options.HtmlSatusContent,
                                                                                        _Options.url,
                                                                                        _Options.data);
                        item.setOnOutStatus();
                        iTems.push(item);
                        AjaxFlagMenu.append(item.jQueryObject);

                        return item;
                };



                /**Global Menu Events*****************************************/
                //Click
                AjaxFlagMenu.mousemove(function(){

                        for(var i=0;i<iTems.length;i++)
                        {
                                if(iTems[i].isClicked())
                                {
                                        LastSelectedItem = iTems[i];
                                        break;
                                }
                        }

                });

                $(this).append(AjaxFlagMenu);


                return this;
        };
})(jQuery,document);